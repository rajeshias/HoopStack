<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoopstack Challenge</title>
    <style>
        :root {
            /* Desktop Defaults */
            --bg-color: #2c2c2c;
            --hoop-height: 25px;
            --hoop-width: 90px;
            --pole-gap: 25px;
            --max-capacity: 10; /* Fixed logic: needs to be 10 to match the 30 items */
            --pole-height: calc(var(--hoop-height) * var(--max-capacity)); 
        }

        /* Mobile Responsive Adjustments */
        @media (max-width: 600px) {
            :root {
                --hoop-width: 16vw; /* Scale based on screen width */
                --hoop-height: 18px; /* Thinner hoops */
                --pole-gap: 8px;     /* Tighter grouping */
            }
            
            h1 { font-size: 1.1rem; text-align: center; line-height: 1.4; }
            p { text-align: center; padding: 0 10px; }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #121212;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
            overflow-x: hidden; /* Prevent scroll */
        }

        h1 { margin-bottom: 5px; text-shadow: 2px 2px 4px black; }
        p { color: #aaa; margin-bottom: 10px; font-size: 0.9rem; }

        #timer-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 15px;
            font-family: monospace;
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 5px;
        }

        #game-board {
            display: flex;
            gap: var(--pole-gap);
            padding: 50px 20px 20px 20px; /* Top padding for lifting space */
            background: #222;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            align-items: flex-end;
            max-width: 95vw; /* Ensure it fits on screen */
            box-sizing: border-box;
        }

        .pole-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            /* Dynamic width slightly larger than hoop */
            width: calc(var(--hoop-width) + 10px); 
            height: calc(var(--pole-height) + 80px); /* Height + space for selection */
            position: relative;
            cursor: pointer;
        }

        .pole-container:hover .pole-stick {
            background: linear-gradient(90deg, #666, #333);
        }

        /* The vertical stick */
        .pole-stick {
            position: absolute;
            bottom: 10px; 
            width: 10px;
            height: var(--pole-height);
            background: linear-gradient(90deg, #444, #111);
            border-radius: 6px 6px 0 0;
            z-index: 0;
            transition: background 0.2s;
        }

        /* The base of the stick */
        .pole-base {
            width: 100%;
            height: 10px;
            background: #000;
            border-radius: 5px;
            z-index: 0;
        }

        /* The Hoops */
        .hoop {
            width: var(--hoop-width);
            height: var(--hoop-height);
            border-radius: 50%;
            margin-bottom: -4px; /* Slight overlap for perspective */
            z-index: 10;
            border: 1px solid rgba(0,0,0,0.3);
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* 3D Shine */
        .hoop::after {
            content: '';
            position: absolute;
            top: 5px; left: 5px; right: 5px; bottom: 5px;
            border-radius: 50%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.3), rgba(255,255,255,0));
            pointer-events: none;
        }

        /* Selected State */
        .hoop.selected {
            transform: translateY(-40px) scale(1.05);
            box-shadow: 0 15px 20px rgba(0,0,0,0.4);
            z-index: 100;
        }

        /* Colors */
        .color-pink { background: linear-gradient(to right, #ff99cc, #ff69b4, #d14785); }
        .color-orange { background: linear-gradient(to right, #ffcc80, #ff8c00, #bf360c); }
        .color-purple { background: linear-gradient(to right, #ce93d8, #9c27b0, #4a148c); }

        .stack-wrapper {
            display: flex;
            flex-direction: column-reverse;
            margin-bottom: 10px; 
            z-index: 1;
        }

        #controls { margin-top: 20px; display: flex; gap: 10px; }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #444;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background 0.2s;
        }
        button:hover { background-color: #666; }

        #message {
            min-height: 40px;
            margin-top: 15px;
            font-weight: bold;
            text-align: center;
            white-space: pre-line; /* Allows new lines */
            line-height: 1.5;
        }
        .error { color: #ff5252; }
        .success { color: #69f0ae; }
        .stats { color: #fff; font-weight: normal; font-size: 0.9em; }

    </style>
</head>
<body>

    <h1>r/gifsthatendsoon Challenge</h1>
    <p>Beat the girl's time (95 seconds)</p>

    <div id="timer-display">Time: 0.0s</div>

    <div id="game-board"></div>

    <div id="message"></div>

    <div id="controls">
        <button onclick="resetGame()">Restart Level</button>
    </div>

    <script>
        const PINK = 'pink';
        const ORANGE = 'orange'; // Fixed class name typo in logic
        const PURPLE = 'purple';
        
        // IMPORTANT: The data provided has 10 items per column, 
        // so max capacity must be 10 for it to be solvable.
        const MAX_CAPACITY = 10; 
        const GIRLS_TIME = 95.0;

        // Bottom to Top pattern
        const STARTING_STATE = [
            [PINK, PURPLE, PINK, ORANGE, PURPLE, ORANGE, PINK, PURPLE, ORANGE, PINK], 
            [PURPLE, ORANGE, PINK, PURPLE, ORANGE, PINK, PURPLE, ORANGE, PINK, PURPLE],
            [ORANGE, PINK, PURPLE, ORANGE, PINK, PURPLE, ORANGE, PINK, PURPLE, ORANGE],
            [] // 4th pole empty
        ];

        let gameState = [];
        let selectedPoleIndex = null;
        let gameActive = false;

        // Timer Variables
        let startTime = null;
        let timerInterval = null;
        let elapsedTime = 0;

        const boardEl = document.getElementById('game-board');
        const messageEl = document.getElementById('message');
        const timerEl = document.getElementById('timer-display');

        function initGame() {
            gameState = JSON.parse(JSON.stringify(STARTING_STATE));
            selectedPoleIndex = null;
            gameActive = true;
            messageEl.textContent = "";
            
            // Reset Timer
            stopTimer();
            elapsedTime = 0;
            timerEl.textContent = "Time: 0.0s";
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 100);

            render();
        }

        function updateTimer() {
            if(!gameActive) return;
            const now = Date.now();
            elapsedTime = (now - startTime) / 1000;
            timerEl.textContent = `Time: ${elapsedTime.toFixed(1)}s`;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function render() {
            boardEl.innerHTML = '';

            gameState.forEach((column, colIndex) => {
                const poleContainer = document.createElement('div');
                poleContainer.className = 'pole-container';
                poleContainer.onclick = () => handlePoleClick(colIndex);

                // The Stick
                const stick = document.createElement('div');
                stick.className = 'pole-stick';
                poleContainer.appendChild(stick);

                // The Hoops
                const stackWrapper = document.createElement('div');
                stackWrapper.className = 'stack-wrapper';

                column.forEach((color, hoopIndex) => {
                    const hoop = document.createElement('div');
                    hoop.className = `hoop color-${color}`;
                    
                    // Add selected class to top hoop if this pole is active
                    if (selectedPoleIndex === colIndex && hoopIndex === column.length - 1) {
                        hoop.classList.add('selected');
                    }
                    stackWrapper.appendChild(hoop);
                });

                poleContainer.appendChild(stackWrapper);

                // The Base
                const base = document.createElement('div');
                base.className = 'pole-base';
                poleContainer.appendChild(base);

                boardEl.appendChild(poleContainer);
            });
        }

        function handlePoleClick(index) {
            if (!gameActive) return;

            messageEl.className = "";
            messageEl.textContent = "";

            // 1. SELECTING
            if (selectedPoleIndex === null) {
                if (gameState[index].length > 0) {
                    selectedPoleIndex = index;
                    render();
                }
                return;
            }

            // 2. DESELECTING
            if (selectedPoleIndex === index) {
                selectedPoleIndex = null;
                render();
                return;
            }

            // 3. MOVING
            const sourcePole = gameState[selectedPoleIndex];
            const targetPole = gameState[index];
            
            // Check Capacity
            if (targetPole.length >= MAX_CAPACITY) {
                messageEl.textContent = "‚ùå Pole is full!";
                messageEl.className = "error";
                return;
            }

            // Move
            targetPole.push(sourcePole.pop());
            selectedPoleIndex = null;
            render();
            checkWin();
        }

        function checkWin() {
            let isWin = true;
            let filledPoles = 0;
            let totalHoops = 0;

            gameState.forEach(p => totalHoops += p.length);
            if(totalHoops === 0) return;

            gameState.forEach(pole => {
                if (pole.length === 0) return;

                const firstColor = pole[0];
                const isUniform = pole.every(c => c === firstColor);
                
                if (!isUniform) {
                    isWin = false;
                } else {
                    if (pole.length === MAX_CAPACITY) {
                        filledPoles++;
                    } else {
                        isWin = false; 
                    }
                }
            });

            if (isWin && filledPoles === 3) {
                gameFinish();
            }
        }

        function gameFinish() {
            gameActive = false;
            stopTimer();
            
            const userTime = parseFloat(elapsedTime.toFixed(1));
            const diff = (Math.abs(userTime - GIRLS_TIME)).toFixed(1);
            
            let comparisonMsg = "";
            if (userTime < GIRLS_TIME) {
                comparisonMsg = `üöÄ Amazing! You were ${diff} seconds FASTER than her!`;
            } else if (userTime > GIRLS_TIME) {
                comparisonMsg = `üêå Oof! You were ${diff} seconds SLOWER than her.`;
            } else {
                comparisonMsg = `‚öñÔ∏è Whoa! You tied exactly with her time!`;
            }

            messageEl.innerHTML = `üèÜ PERFECT! JUSTICE IS SERVED! üèÜ<br><span class="stats">Your Time: ${userTime}s | Her Time: ${GIRLS_TIME}s<br>${comparisonMsg}</span>`;
            messageEl.className = "success";
            
            // Celebration effect
            timerEl.style.color = "#69f0ae";
            timerEl.textContent = "DONE: " + userTime + "s";
        }

        function resetGame() {
            timerEl.style.color = "#ffd700";
            initGame();
        }

        initGame();

    </script>
</body>
</html>
